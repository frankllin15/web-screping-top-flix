"use strict";isWEB=!0;var selector=new function(){let e=0,t=null,s="Powers",o={gesture:"wb",glasses:"w1",acting:{rrh:["wa","wb","ww","wt","wh","ws","wg","wm"]},easterland:{eggfx:["wc","we","wf","wl","wx"]},valfx:{vthrow:["wh","wc","wC","wH","we","wp","wP","ws","wS","wx","ww"],vkiss:["wh","wc","wC","wH","we","wp","wP","ws","wS","wx","ww"],vrain:["wh","wc","wC","wH","we","wp","wP","ws","wS","wx","ww"]},allhallows:{candyfx:["wc","ws","we","wb","wd","wg","wx","ww"]}};ThisPage="selector";const l=document.querySelector("#goBack");setdarkmode(),parent.Classic||(l.className="gobackMob");let n=!1;var a,r;this.DoLoginEtc=function(e){let t={LoginRegEtc:1};if(t[e]=1,selector.clear(t),xrRoot.LoginBodge=!1,parent.removeClass("d-none","selectorFrame"),ae(getById(e).childNodes[1].innerText),n||(selector.addLoginListerners(),n=!0),"AreYouABot"==e){if(addClass("d-none","captchaErr"),re(!0,"loader"),xrRoot.xrClassic){selector.isCaptcha=!0,parent.classicSetDialog("selector",0);let e=parent.document.querySelector(".dialogBody");e&&(e.style.cssText="height: 40%;");let t=parent.document.querySelector(".modalDialogContentClassic");t&&(t.style.top="85px"),parent.ConnectingClose()}selector.loadCaptcha(),setTimeout(selector.sendCaptcha,1e3)}"LoginForm"==e&&xrRoot.xrPWAinstall()&&removeClass("d-none","installpwa"),TranslateAll()},this.DoLoginMessage=function(e){let t=clearDiv("loginErr");addText(t,e),xrRoot.removeClass("d-none","Overlays")},this.LoginCancel=function(){modalClose(),NotLoggedIn&&selector.doLoginDialog()},this.Logout=function(){localStorage.clear();let e=parent;e.parent&&(e=e.parent),e.location.reload()},this.Login=function(){var e=document.getElementById("openModal");e&&(e.style.visibility="hidden");let t=document.querySelector("#loginErr");t&&(t.innerHTML="");var s={Page:"profile",Command:"Login"};if(s.Username=document.getElementById("lusername").value,s.Password=document.getElementById("lpassword").value,FillInAll(s,["Username","Password"],t)){ToC(s),xrRoot.LoginBodge=!0;let e=xrRoot.getById("Overlays");addClass("d-none",0,e)}return!1};var i=/[^0-9A-Za-z]/g,c=/[^0-9A-Za-z\.\-@_]/g;this.Register=function(){let e=document.querySelector("#registerErr");e&&(e.innerHTML="");var t={Page:"profile",Command:"Register"};return t.Username=document.getElementById("rusername").value,a=t.Password1=document.getElementById("rpassword1").value,r=t.Email=document.getElementById("remail").value,FillInAll(t,["Username","Password1","Email"],e)&&(t["g-recaptcha-response"]=selector.getCaptchaResponse(),ToC(t)),!1},this.forgotPass=function(e){let t,s=document.querySelector("#lostErr");s&&(s.innerHTML="",s.style.color="red"),selector.loadCaptcha();let o=document.getElementById("lusername");if(o||(o=document.getElementById("lemail")),o&&(o=o.value.toLowerCase()),e&&(t=e),xrRoot.removeClass("d-none","Overlays"),e&&"{"==e.charAt(0)){let o=JSON.parse(e);if(o.html)return s&&(s.style.color="green"),void addText(s,o.html,!0);t=""}selector.DoLoginEtc("ResetPassword"),t&&addText(s,t,!0),o&&(document.getElementById("lemail").value=o)},this.ResetPassword=function(){let e=document.querySelector("#lostErr");e&&(e.innerHTML=""),selector.loadCaptcha();var t={Page:"profile",Command:"ResetPassword"};return r=t.Email=document.getElementById("lemail").value.toLowerCase(),FillInAll(t,["Email"],e)&&(t["g-recaptcha-response"]=selector.getCaptchaResponse(),ToC(t)),!1},this.RegisterError=function(e){let t=document.querySelector("#registerErr");if(t&&(t.innerHTML="",t.style.color="red"),selector.loadCaptcha(),xrRoot.removeClass("d-none","Overlays"),"{"==e.charAt(0)){let s=JSON.parse(e);t&&(addText(t,s.html,!0),t.style.color="green"),s.html="",s.Page="profile",s.Command="SetUserId",ToC(s)}else addText(t,e,!0)},this.doRegisterDialog=function(e){selector.DoLoginEtc("RegisterDialog"),selector.loadCaptcha(),e&&((e=JSON.parse(e)).RegisterName&&(document.getElementById("rusername").value=e.RegisterName),e.RegisterPass&&(document.getElementById("rpassword1").value=e.RegisterPass),e.RegisterEmail&&(document.getElementById("remail").value=e.RegisterEmail)),document.getElementById("rpassword1").onkeyup=function(e){return restrictCharacters2(e,i)},document.getElementById("remail").onkeyup=function(e){return restrictCharacters2(e,c)}},this.loadCaptcha=function(){"object"==typeof grecaptcha&&grecaptcha.ready((function(){grecaptcha.execute("6LdBquAZAAAAADOcFT2FE6WuXn9IzWwtJ-nr8K9o",{action:"register"}).then((function(e){let t=document.querySelector("#g-recaptcha-response");t&&(t.value=e)}))}))},this.getCaptchaResponse=function(){let e=document.querySelector("#g-recaptcha-response");return e?e.value:""},this.sendCaptcha=function(){let e={m:3,j:selector.CapJson,"g-recaptcha-response":selector.getCaptchaResponse()};loadJSON("/web_gear/chat/AreYouaHuman.php",selector.GotCap,selector.GotCapFailed,e)},this.GotCap=function(e){if(e.error)return selector.GotCapFailed(e);re(!1,"loader"),addClass("d-none","verification"),removeClass("d-none","captchaOk"),removeClass("d-none","capYes"),addClass("d-none","captchaErr"),addClass("d-none","capNo"),setTimeout((()=>{ToC(e),xrRoot.setFrameVis()}),3e3)},this.GotCapFailed=function(e){re(!1,"loader"),addClass("d-none","verification"),removeClass("d-none","captchaErr"),removeClass("d-none","capNo"),addClass("d-none","captchaOk"),addClass("d-none","capYes")},this.isCaptchaPage=function(){let e=document.querySelector("#AreYouABot");return!!e&&!e.classList.contains("d-none")},this.LoginSetName=function(){r&&r.length>0&&(document.getElementById("lusername").value=r),a&&a.length>0&&(document.getElementById("lpassword").value=a)},this.doProfileDialog=function(){selector.DoLoginEtc("EditProfileDialog");var e=MainObj.user[0];document.getElementById("iname").value=e.name,document.getElementById("iavatar").value=e.avatar,document.getElementById("istatus").value=e.status,document.getElementById("ihomepage").value=e.homepage},this.doLoginDialog=function(e){xrRoot.selector.DoLoginEtc("LoginForm")},this.termsOfService=function(){var e={Next:"help"};parent.setFrameVis(),modalClose(),ToC(e)},this.doChat=function(){ToC({Command:"MakeId",Next:"chats"})},this.PwaInstall=function(){var e;null==(e=xrRoot.xrPWA)||e.PWAinstall()};var d={pwaInstall:function(){selector.PwaInstall()},LoginCancel:function(){selector.LoginCancel()},forgotPass:function(){selector.forgotPass()},doRegisterDialog:function(){selector.doRegisterDialog()},Logout:function(){selector.Logout()},termsOfService:function(){selector.termsOfService()},doLoginDialog:function(){selector.doLoginDialog()},Register:function(){selector.Register()},getXats:function(){getXats()},quitEdit:function(){selector.quitEdit()},saveProfile:function(){selector.saveProfile()},clearLogin:function(){clearAlertMessage(),selector.Login()},LoginAndSetName:function(){selector.doLoginDialog(),selector.LoginSetName()},clearResetPassword:function(){clearAlertMessage(),selector.ResetPassword()},modalClose:function(){modalClose()},doSignup:function(){selector.doRegisterDialog()},doLogin:function(){selector.DoLoginEtc("LoginForm")},doHelp:function(){xrRoot.setFrameVis(),xrRoot.setPage("help")},doChatNow:function(){xrRoot.setFrameVis(),selector.doChat()}};this.addLoginListerners=function(){var e,t;for(e in l&&l.classList.add("d-none"),d)(t=document.getElementById(e))&&t.addEventListener("click",d[e])};function m(e){let t,s=clearDiv("stiff"),o=makeElement(s,"div"),l=makeElement(o,"ul","nav nav-tabs buytab");for(let s in e.catagory){let o=e.catagory[s][0];if("@"!=o.charAt(0))continue;let n=makeElement(l,"li","nav nav-tabs buytab");o=o.substr(1),addText(n,o.toLowerCase()),n.Catagory=o,t||(t=o,addClass("active",0,n)),n.addEventListener("click",u)}makeElement(s,"div",0,"ToBuy");s.Obj=e,u(t),parent.Classic&&ie()}function u(e){if("string"!=typeof e){let t=document.getElementsByClassName("active");for(;t.length;)removeClass("active",0,t[0]);addClass("active",0,e.currentTarget),e=e.currentTarget.Catagory}let t=getById("stiff"),s=clearDiv("ToBuy"),o=t.Obj,l=makeElement(s,"div","box buygiftlist"),n=document.querySelector("#front").value,a=document.querySelector("#message").value,r=xInt(microtime(!0));for(let s in o.catagory){let i=o.catagory[s];if(e==i[0]||e==i[0].substr(1)){for(let e=1;e<3;e++){let s=i[e];if(!s)break;s=s.split(",");let c=s[1],d="category"==s[0],m=2;for(;;){let e=s[m];if(!e)break;if(d){d=e=e.substr(1);for(let t in o.catagory)if(e==o.catagory[t][0]){e=o.catagory[t][1],e=e.split(","),e=e[2];break}}let i=makeElement(l,"div","box2"),u=t.Obj.params[e.toLowerCase()];u||(u={}),u.n=selector.MyRegName,u.id=selector.MyObj.MyId,u.m=a,u.g=e,u.c=c,u.f=100==c?4:0,u.Time=r;let g=S(i,u,2|(d?4:0));g.Scene.CardObj=u;let f=e;if(c>0&&(f+=", "+c+" xats"),addToolTip(g,f,!0,"low",null,null,null,!0),d){makeElement(i,"br");let e=makeElement(i,"div","","giftuname");addText(e,d),g.Scene.Catagory=d}else u.s=n;m++}}break}}}function g(e){if("OK"==e)return document.querySelector("#front").value="",document.querySelector("#message").value="",document.querySelector("#password").value="",document.querySelector("#pm").checked=!1,ne(),void selector.clear();AlertMessage(e)}this.BuyGifts=function(){Q("BuyGifts")||(selector.clear({stiff:1}),removeClass("d-none","messageBlock"),removeClass("d-none","FrontId"),ae([["box.312","Send a gift to"]," "+selector.Name+" ("+selector.UserNo+")"]),GetXconsts("selector",["Auth","MainObj","end"]))};let f,p,y="all",h=[];this.gifts=function(e){l&&l.classList.add("d-none"),Q("Gifts")||(selector.clear({Tabs:1,stiff:1}),addClass("active","GiftsBut"),e&&(e.id&&(selector.UserNo=e.id),e.regname&&(selector.Name=e.regname),e.cb&&(selector.cb=e.cb)),!selector.MyObj||selector.UserNo&&selector.UserNo!=selector.MyObj.MyId?selector.gotGifts1():(selector.UserNo=selector.MyObj.MyId,selector.UserNo||(selector.MyObj=parent.MyObj,selector.UserNo=selector.MyObj.MyId),selector.Name=selector.MyObj.MyRegName,selector.cb=selector.MyObj.cb,GetXconsts("selector",["Auth","end"])))},this.gotGifts1=function(){let e,t="https://xat.com/web_gear/chat/gifts22.php";selector.MyObj&&selector.UserNo==selector.MyObj.MyId&&(selector.Name=selector.Auth.RegName),ae([["box.257","Gifts"],""+selector.Name=="undefined"?" - "+selector.UserNo:" - "+selector.Name+" ("+selector.UserNo+")"]),selector.UserNo==selector.MyObj.MyId?(e={},e.PassHash=selector.Auth.PassHash,e.DeviceId=selector.Auth.DeviceId,e.id=selector.MyObj.MyId,e.k=f||h[1],e.k&&!h[0]&&(e.old=1),h[1]&&(e.flags=h[0]),e.del=p,p=0,h=[]):t+="?id="+selector.UserNo+"&cb="+selector.cb,y="all",re(!0),loadJSON(t,v,k,e)};function v(e){if("Gifts"!==s)return;if(e.cb){ToC({Page:"selector",Command:"CacheBust"}),delete e.cb}let t=clearDiv("stiff");w(e);let o=makeElement(t,"div","box"),l=Object.keys(e).sort().reverse();for(let t in l){let s=l[t];e[s].Time=s;let n=makeElement(o,"div","box2"),a=null==e[s].f||0==(1&parseInt(e[s].f));n.setAttribute("data-gFlag",e[s].f),S(n,e[s]),makeElement(n,"br");let r=e[s].n,i=makeElement(n,"div","","giftuname");if(addText(i,r),r.length>6&&(i.style.fontSize="12px",i.style.marginTop="5px"),r.length>9&&(i.style.fontSize="10px",i.style.marginTop="5px"),r.length>14&&(i.style.fontSize="8px",i.style.marginTop="5px"),a){let e=makeElement(n,"img","privateGift");e.src="svg/lock.svg",e.width="25"}}re(!1)}function w(e){let t=document.querySelector("#stiff"),s=makeElement(t,"div","totalbut","total"),o=makeElement(t,"div","sendgiftbut","total"),l=selector.MyObj.MyId==selector.UserNo,n=makeElement(o,"div",l?"sendinv":"","giftTotal");if(selector.MyObj.MyId!==selector.UserNo){let e=makeElement(n,"img");addText(n,["box.311","send gift"]),e.src="svg/giftssend.svg",e.width="19",e.addClass="sendgifticon",n.addEventListener("click",selector.BuyGifts)}let a=Object.keys(e).length||"0",r=makeElement(s,"div","","giftTotal"),i=makeElement(r,"img");i.src="svg/actGifts.svg",r.classList.add("giftActiveFilter"),i.setAttribute("data-filter","all"),r.setAttribute("data-filter","all"),addText(r,a),r.addEventListener("click",(e=>{0!=a&&b(e)}));let c=makeElement(s,"div","","giftTotal"),d=makeElement(c,"img");var m=Object.keys(e).filter(((t,s)=>null==e[t].f||0==(1&parseInt(e[t].f))));d.src="svg/giftslock.svg",d.setAttribute("data-filter","public"),c.setAttribute("data-filter","public"),addText(c,Object.keys(m).length||"0"),c.addEventListener("click",(e=>{0!=m.length&&b(e)}));let u=makeElement(s,"div","","giftTotal"),g=makeElement(u,"img");var f=Object.keys(e).filter(((t,s)=>1&parseInt(e[t].f)));g.src="svg/giftsunlock.svg",g.setAttribute("data-filter","private"),u.setAttribute("data-filter","private"),addText(u,Object.keys(f).length||"0"),u.addEventListener("click",(e=>{0!=f.length&&b(e)}))}function k(e){let t=clearDiv("stiff"),s=selector.UserNo==selector.MyObj.MyId?["box.313","You have no gifts."]:["box.314","User has no gifts."];w({}),re(!1);let o=makeElement(t,"span","text-center nogift");addText(o,s)}function b(e){let t=e.target.dataset;if(!t||!t.filter)return;"IMG"==e.target.nodeName?e.target.parentNode.classList.add("giftActiveFilter"):e.target.classList.add("giftActiveFilter");let s=t.filter;if(s!==y){let e=document.querySelector('[data-filter="'+y+'"]');e&&e.classList.remove("giftActiveFilter");let t=document.querySelectorAll(".box2");if(t.length>0)for(let e=0;e<t.length;e++){let o=t[e].dataset,l=parseInt(o.gflag);switch(s){case"all":t[e].style.display="inline-block";break;case"public":t[e].style.display=1&l?"none":"inline-block";break;case"private":t[e].style.display=null==l||0==(1&l)?"none":"inline-block"}}y=s}}function C(e){f=e.currentTarget.Time,selector.gifts()}function E(e){h=[e.currentTarget.Flags,e.currentTarget.Time],selector.gifts()}function x(){let e=clearDiv("BigCard");return e.removeEventListener("click",T),addClass("d-none",0,e),e}function T(e){isNaN(e)&&(e=0),setTimeout((function(){getById("BigCard").Small.style.visibility="visible",x()}),e)}function S(e,t,s){s||(s=0);let o=224,l=284,n=selector.UserNo==selector.MyObj.MyId,a=makeElement(e,"div","hold"),r=a.Scene=makeElement(a,"div","scene"+(1&s?"-big":""),"tt"+t.Time),i=makeElement(r,"div","gift"),c=makeElement(i,"div","giftFace giftFaceFront"),d=SVG().addTo(c).viewbox(0,0,l,320),m=null==t.f||0==(1&parseInt(t.f)),y=t.g.replace(/[^0-9a-zA-Z]/g,"_").toLowerCase();2&t.f&&(y=4&t.f?"unopenedgift":"unreadcard");let h=d.image("https://xat.com/images/js/gift/"+y+".svg?z1");if(2&t.f)return n?(r.Time=t.Time,void r.addEventListener("click",C)):(addToolTip(a,["box.309","User must read gift first"],!1,null,null,null,!1),void(a.style.opacity="0.4"));if(4&t.f&&t.s){h.scale(.9),h.translate(15,20)}if(2&s&&!n){let e=document.querySelector("#message"),s=document.querySelector("#front");e&&e.value.length&&(t.m=e.value),s&&s.value.length&&(t.s=s.value),t.n=selector.Auth.RegName||"",t.id=selector.MyObj.MyId}t.s||(t.s=" ");{let e="M30,96 C77,25 192,25 254,96",s=8&t.f;if(s){if(o=l," "!=t.s){let e="0,46 284,1 284,48 0,93";d.polygon(e).fill({color:"#000",opacity:.3}).transform({translateY:6}),d.polygon(e).fill("#"+toHex6(t.FrontColBkg))}e="M10,83 C100,65 183,52 274,38"}let n=t.FrontColText;Array.isArray(n)||(n=[n,n]),"number"==typeof n[0]&&(n[0]="#"+toHex6(n[0]),n[1]="#"+toHex6(n[1]));let a=d.text((function(e){e.tspan(t.s)}));a.path(e);let r=5,i=n[0];n[0]==n[1]||s||(i=d.gradient("radial",(function(e){e.stop(.45,n[1]),e.stop(1,n[0])})),i.attr({cx:.5,cy:.73})),a.font({fill:i,size:r,family:"Arial, Helvetica, sans-serif"});let c=0;for(;c++<10&&a.length()<o/2;)r*=1.2,a.font("size",r);r=2*r/1.1,r>40&&(r=40),a.font("size",r),a.textPath().attr("startOffset",Math.round(100*(142-a.bbox().cx)/l)+"%")}if(1&s){let e=makeElement(i,"div","giftFace giftFaceBack"),o=makeElement(e,"div","giftTitle"),l=makeElement(e,"div","giftMessage"),a=makeElement(e,"div","giftAcc");var v=GetTimeToGo(1e3*t.Time,!0);let r=makeElement(e,"div","giftFooter");if(addText(o,v),makeElement(o,"br"),2&s||(m&&(n||(t.m=["box.305","Message is private"],l.style.opacity="0.4")),(""===t.m||t.noMessage)&&(t.m=["box.304","No message included"],l.style.opacity="0.4",t.noMessage=!0)),(t.m.length>80||t.topgap)&&(l.style.top="36%",t.topgap=!0),(t.m.length>170||t.bigtext)&&(l.style.fontSize="17px",t.bigtext=!0),(t.m.length<80||t.topgaporg)&&(l.style.top="40% !important",t.topgaporg=!0),(t.m.length<170||t.bigtextorg)&&(l.style.fontSize="22px !important",t.bigtextorg=!0),addText(l,t.m),makeElement(l,"br"),addText(a,t.n+" ("+t.id+")"),n&&!(2&s)){let e=makeElement(r,"button","giftDelete GiftMake"),s=makeElement(e,"img");s.src="svg/giftsdelete.svg",s.width="22",e.Time=t.Time,e.addEventListener("click",(e=>{setTimeout((()=>{!function(e){let t=makeElement(null,"img");t.src="svg/xdelete.svg",t.alt="close";let s=makeElement(null,"div"),o=makeElement(s,"div","modalDialogContentClassic"),l=makeElement(o,"div","dialogTitleBar"),n=makeElement(l,"span","dialogTitle link","openLink"),a=(makeElement(l,"span","dialogTitleAction","id_ModalClose").appendChild(t),makeElement(o,"div","dialogBody")),r=makeElement(a,"div","dialogPadding"),i=makeElement(r,"div","wrapper","wrapper"),c=makeElement(a,"div","dialogActions"),d=makeElement(c,"div","butcontainer previewBut centered").appendChild(makeElement(null,"div","butlayout","actionButton"));addText(n,["box.306","Confirm deletion"]),o.dataset.w=.6,addText(i,["box.307","Delete this gift?"]),d.innerHTML="",addText(d,["box.308","Delete"]),HiddenDivs.AlertDialog=s.innerHTML,doModal("AlertDialog"),ColorTitle(),setButCols(parent.config.ButCol,parent.config.ButColW);let m=e;document.querySelector("#actionButton").addEventListener("click",(()=>{p=m.target.Time,null==p&&(p=m.target.parentElement.Time),modalClose(),selector.gifts()})),document.querySelector("#id_ModalClose").addEventListener("click",(()=>{modalClose()}))}(e)}),1250)}));let o=makeElement(r,"button","GiftMake");addText(o,m?["box.302","Make public"]:["box.303","Make private"]),o.Time=t.Time,o.Flags=m?"1":"0",o.addEventListener("click",E)}}function w(e){if(e&&e.stopPropagation(),4&s)return void u(e.currentTarget.Catagory);if(2&s&&document.getElementById("password").value.length>1)return void function(e){let t=e.currentTarget.CardObj,s=selector.Auth;t.b=selector.UserNo,t.u=s.UserNo,t.r=s.RoomId,t.w=ST2(TransText("box.254","$1 has bought $2  a $3"),GetAsMB(s.RegName),GetAsMB(selector.Name),4&t.f?"gift ":"card"),t.t=s.dt,t.p=getById("password").value,t.s=getById("front").value,t.m=getById("message").value,t.f=1,document.getElementById("pm").checked&&(t.f&=-2),loadHTML(chatUrl+"buygifts.php",g,0,t)}(e);let o=x();removeClass("d-none",0,o);let l=o.Rect=a.getBoundingClientRect(),n=S(o,t,1|s);o.Big=n,o.Small=a,n.style.left=l.left-10+"px",n.style.top=l.top-10+"px",a.style.visibility="hidden",o.addEventListener("click",T)}if(1&s){r.Big=1;let e=document.getElementById("BigCard");r.addEventListener("click",(function(e){e&&e.stopPropagation();let t=document.getElementById("BigCard").Big.Scene;0!=t.Big&&(t.classList.contains("is-zoomed")?i.classList.contains("is-flipped")?(t.style.transform="",t.classList.toggle("is-zoomed"),i.classList.toggle("is-flipped"),T(1250)):i.classList.toggle("is-flipped"):t.classList.toggle("is-zoomed"))})),r.classList.toggle("is-zoomed");let t=e.offsetWidth/2-35;r.style.transform="translate("+(t-e.Rect.left)+"px,"+(180-e.Rect.top)+"px) scale(0.85) rotate(360deg)"}else r.Big=0,r.addEventListener("click",w),f==t.Time&&(f=0,w());return a}function B(e,t,s){let o=makeElement(e,"div","stickercell");o.style.float="left";let l=makeElement(o,"img");l.border=0,l.width=100,l.height=100,l.draggable=!1;let n=t[0].replace(/[^0-9a-zA-Z]/g,"_").toLowerCase();return l.src="https://gs.xat.com/h_s_"+n+"_"+(t[1]?encodeURIComponent(t[1]):"")+".png",(new Image).src=l.src,o.addEventListener("click",s),o}this.stickers=e=>{selector.hideWallet(),l&&l.classList.add("d-none"),Q("Sticker")||(t="string"==typeof e?e:null,selector.clear({Tabs:1}),re(!0),addClass("active","StickBut"),GetXconsts("selector",["Stickers","w_Powers","pssa","end"]))};let L=null,M=null;function I(e){selector.hideWallet();let s=selector,o={},l={};s.AllStickers=e,document.querySelector("#stickMessage").value="",ae(["box.295","Send a sticker"]);const n=parent.document.getElementById("textEntryEditable");n&&n.focus(),addToolTip(document.querySelector("#stickColor1"),["box.315","Add inner color"],!0,"low"),addToolTip(document.querySelector("#stickColor2"),["box.316","Add outer color"],!0,"left"),["#stickColor1","#stickColor2"].forEach((e=>{let t=Pickr.create({el:e,theme:"nano",preview:!0,useAsButton:!0,closeOnScroll:!0,lockOpacity:!0,components:{palette:!0,preview:!0,opacity:!0,hue:!0,interaction:{save:!0,input:!0}}}).on("change",((t,s)=>{"#stickColor1"==e?(L=t.toHEXA().toString(),document.querySelector("#stickMessage").style.color=L):(M=t.toHEXA().toString(),document.querySelector("#stickMessage").style.background=M)})).on("save",((e,s)=>{t.hide()}))}));for(let t in s.Stickers){let n=s.pssa[xInt(t)+1],a=e[n];ee(t)?o[n]=a:l[n]=a}let a=document.getElementById("stiff");function r(e){let t=document.querySelector("#stickMessage").value;L==M&&(L=M=""),selector.clear();let s={Page:"messages",Command:"Paste"};s.Paste="("+e.target.parentNode.name+"#"+t+L+M+")",ToC(s),ne()}function i(e){clearDiv("stiff"),removeClass("d-none","stickMessageBlock");for(let t in s.AllStickers[e]){const o=e+"."+s.AllStickers[e][t],l=B(a,[o,""],r);addToolTip(l,"("+o+")",!0,"low"),l.name=o}}function c(e,s,o){if(t)i(t);else for(let t in s)if(s[t]){const l=B(e,[t+"."+s[t][Math.floor(Math.random()*s[t].length)],t],(()=>{i(t)}));o?(l.style.opacity="0.6",addToolTip(l,["mob2.nostickers","You need $1 power to use these stickers.",capitalize(t)],!0,"low")):addToolTip(l,["box.301","View stickers"],!0,"low")}}removeClass("d-none","stiff");let d=makeElement(a,"div");c(d,o),d=makeElement(a,"div"),c(d,l,1),re(!1)}const P={Snow:56,Animal:-116,WildHorses:124,SteamTrain:124,Rocket:133,Stoneage:135};function A(e){selector.clear();let t={Page:"messages",Command:"Paste"},s=e.target.parentNode.parentNode.parentNode.name;t.Paste="("+(s.indexOf("#")>=0?s:s+"#")+")",ToC(t),ne()}function O(e,t,s){let o=selector.pssa&&selector.pssa.indexOf(t)>=0,l=makeElement(e,"div");l.style.float="left",l.name=t,l.style.padding="0.65rem 1.65rem",o&&X&&l.classList.add("mainPower","powind");let n=LoadImage(l,"("+t+")","avatar",-3);return addToolTip(n,"("+t+")",!0,"low"),o&&X?n.addEventListener("click",(e=>{X=!1,e.target.dataset.smw=t,N(e)})):n.addEventListener("click",(e=>{X=!1,s(e)})),l}function N(e){let t=document.getElementById("stiff");selector.clear({Tabs:1,stiff:1}),addClass("active","SmBut");let s,n=e.target.dataset.smw;switch(n){case"yellows":s=selector.syel,document.querySelector("#stiff").style.height="",document.querySelector(".powersScroll").style.height="";case"others":s||(s=selector.soth),s=s.split(","),document.querySelector("#stiff").style.height="",document.querySelector(".powersScroll").style.height="";break;default:let e;for(let t in selector.pssa)if(n==selector.pssa[t]){e=xInt(t)-1;break}s=[n];for(let t in selector.topsh)e==selector.topsh[t]&&s.push(t)}for(let e in s)O(t,s[e],A);if(o[n]){let e=makeElement(t,"div"),l=Object.prototype.toString.call(o[n]);if("[object Object]"==l){let t=o[n];for(let s in t)for(let o in t[s])O(e,s+"#"+t[s][o],A)}else for(let t in s)if("[object Array]"==l)for(let l in o[n])O(e,s[t]+"#"+o[n][l],A);else O(e,s[t]+"#"+o[n],A)}l&&(l.classList.remove("d-none"),l.addEventListener("click",(()=>{selector.startSmilies(),setTimeout((()=>{let e=document.getElementById(n+"Container");if(e){let t={behavior:"smooth"};Browser&&"FF"===Browser&&(t.block="center"),e.scrollIntoView(t)}}),700)})))}this.clicKiss=function(e){let t=document.getElementById("password").value,s=document.getElementById("message").value,o={Page:"selector",Command:"TestKiss",Name:e.target.name,Message:s};if(t){if(o.Command="SendKiss",o.Password=t,e.target.Type)switch(o.Command="Action",o.n=e.target.name,o.name=e.target.Type,selector.MarryType){case"Divorce":o.UserNo=1;break;case"Marry":o.UserNo=selector.id}document.getElementById("password").value="",document.getElementById("message").value="",ne()}ToC(o)},this.doKisses=function(e){if(this.MarryType=e,l&&l.classList.add("d-none"),Q("Kiss"))return;selector.clear({Tabs:1}),addClass("active","KissBut");let t=["box.224","Send a kiss"];switch(e){case"Divorce":t=["box.222","Get Divorced"];break;case"Marry":t=["box.221","Get Married"]}ae(e?[t," - "+selector.regname+" ("+selector.id+")"]:[t]),re(!0),t=["w_Powers","w_GroupPowers","MainObj","end"],e&&t.unshift("Marry"),GetXconsts("selector",t)},this.doKisses2=function(){let e=document.getElementById("stiff");function t(t,s,o){let l=makeElement(e,"img","kisscell");l.border=0,l.width=83,l.height=60,l.src="https://gs.xat.com/f_ks-t"+t+"_166_120_2_.png",(new Image).src=l.src,l.Cost=s,l.Type=o,l.name=t,l.draggable=!1,addToolTip(l,t+", "+s+" xats",!0,"low",null,null,null,!0),l.addEventListener("click",selector.clicKiss)}function s(e){(e=e.split(",")).shift();let s=e.shift();for(let o in e){let l=e[o];if(!l)continue;let n=P[l];n&&!ee(n)||t(l,s)}re(!1)}if(removeClass("d-none","messageBlock"),removeClass("d-none","stiff"),this.MarryType){let s;s="Marry"==this.MarryType?["Marry","BFF"]:["Divorce"];for(let o in s){let l=makeElement(e,"div","marBff");if("Marry"==s[o]){addText(l,["mob2.marry","Marry"])}else if("BFF"==s[o]){addText(l,["box.160","BFF"])}else if("Divorce"==s[o]){addText(l,["box.150","Divorce"])}l=this.Marry[s[o]].split(",");for(let e in l)t(l[e],"Divorce"!=s[o]?200:0,s[o])}re(!1)}else loadJSON("https://xat.com/web_gear/chat/kiss.php",(function(e){for(let t in e)s(e[t][1]),s(e[t][2])}));parent.Classic&&ie()},this.startSmilies=function(){if(l&&l.classList.add("d-none"),Q("Smilies"))return;selector.clear({Tabs:1,searchBlock:1}),addClass("active","SmBut"),addClass("d-none","s__mem"),GetXconsts("selector",["SuperPowers","Types","MainObj","w_Powers","topsh","syel","soth","pssa","end"],selector),ae(["box.296","Select a smiley"]);const e=parent.document.getElementById("textEntryEditable");e&&e.focus(),hideTooltip(),document.querySelector(".dropdown-content").style.top="100px"},this.doSmilies=function(e){selector.hideWallet();let t=this.MainObj&&this.MainObj.AllPowers?this.MainObj.AllPowers[0]:{};this.Powers=function(e){let t=[];for(var s in e)for(var o=32*s,l=0;l<32;l++)e[s]&1<<l&&(t[o+l]=1);return t}(t),e=this.initPowers();let s=U();e||(e="");let o=e;o=o.replace(/\./g,":");let l=z(o,s);l.sort||j(0,0,l);for(let e in s){let t;(l[t=s[e][0]]&&l[t]==s[e][1]||l[t=s[e][1]])&&j(t,l[t],l)}j("s",l.s,l)},this.initPowers=function(){this.MainObj&&this.MainObj.PowersMask?this.Mask=this.MainObj.PowersMask[0]:this.Mask=null;let e=document.getElementById("search");e.value.includes(":mem")||(e.value="");let t=U();e.value=W(z(e.value,t),t),e.oninput=J,e.onfocus=_,removeClass("d-none","searchBlock"),this.Mask?(removeClass("d-none","s__miss"),removeClass("d-none","s__off")):(addClass("d-none","s__miss"),addClass("d-none","s__off"),e.value=e.value.replace(":miss",""),e.value=e.value.replace(":off","")),this.order={epic:1,function:1,collection:1,smiley:1,other:1},"Smilies"==s&&(this.order={standard:1,smiley:1,collection:1,other:1,epic:1,function:1},this.Types.standard="0,1,standard,10001,10002",this.Powers[10001]=1,this.Powers[10002]=1,this.pssa[10002]="yellows",this.pssa[10003]="others"),this.categories={};for(let e in this.Types){if("standard"==e&&"Smilies"!==s)continue;let t=this.Types[e].split(",");{let s=t[2];this.categories[s]||(this.categories[s]={}),this.categories[s][e]=t,this.order[s]||(this.order[s]=1)}}this.categories.epic.epic[0]=0,this.Powers[127]=0;let o=this.categories.collection;if(o){let e=o.supers;delete o.supers,o.supers=e}document.getElementById("morebut").onclick=G,window.onclick=e=>{if("morebut"!=e.target.id){let e=document.getElementById("searchopts");"block"==e.style.display&&(e.style.display="none")}},_();let l=document.querySelectorAll(".searchopt");for(let e=0;e<l.length;++e)l[e].onclick=H;return this.Go=!1,e.value},this.startPowers=function(){Q("Powers")||(removeClass("d-none","s__mem"),GetXconsts("selector",["SuperPowers","Types","pssa","end"],selector),document.querySelector(".dropdown-content").style.top="calc(2.25rem + 2px)",parent.actions.Name&&ae(parent.actions.Name))};let R=!1,D="";function q(e,t){let s=document.getElementById(e);s&&(s.innerHTML+=t)}function j(e,t,o,l){let n="",a=selector.pssa.length,r=[],i=0,c="Powers"==s;{let s,l,d,m=0,u=1;switch(e+":"+t){case"sort:91":u=-1,m=selector.Powers.length-1;case"sort:19":for(d=m;s=selector.Powers[d],l=selector.pssa[1+d],s&&i++,l&&(n+=K(d,l,s,c),r.push(l)),d+=u,!(d>a||d<=0););break;case"sort:za":u=0;case"sort:az":let g=[];for(d=m;s=selector.Powers[d],l=selector.pssa[1+d],s&&i++,l&&(g.push([l,K(d,l,s,c)]),r.push(l)),d++,!(d>a););g.sort(u?Y:Z);for(let e in g)n+=g[e][1];break;case":all":case"on:true":case"off:true":case"miss:true":return;default:if("s"==e){t||(t="");let e,s=t,l=(s.charAt(0),s.length<=1);s=s.toLowerCase();let n=0;return Object.values(document.querySelectorAll("[data-sm]")).forEach((a=>{let r=a.dataset.sm;e=!0;let i=a.dataset.pn;for(;(!t||(e=l?r.startsWith(s):r.indexOf(s)>=0,e))&&(!o.off||(e=selector.Mask[i>>5]&1<<i%32,e));){let t=!!selector.Powers[i];if(o.miss){e=!t,i==r&&(e=!1);break}if(o.all)break;e=t;break}e||n++,a.style.display=e?null:"none",!e&&a.parentNode&&a.parentNode.classList.contains("mainPower")&&(a.parentNode.style.display="none")})),F(n),void V()}}}if(!l){if(n)document.getElementById("flexy").innerHTML='<div class="selectorContainer">'+n+"</div>";else{let e=!!selector.Mask,t=document.getElementById("flexy");t.innerHTML="";let o=c?"":"d-none";for(let l in selector.order){let a=0,d=0;t.innerHTML+='<div id="'+l+'Container" class="selectorContainer sectionText '+o+'" data-sub="'+l+'">'+l+'</div>\n            <div id="'+l+'Category" class="selectorContainer"></div>';for(let t in selector.categories[l]){let o=0,m=0;document.getElementById(l+"Category").innerHTML+='<div id="'+t+'ScContainer" class="selectorContainer subSectionText" data-sub="'+t+'">'+t+'</div>\n              <div id="'+t+'ScCategory" class="selectorContainer"></div>',n="";for(let e=3;;e++){let u=parseInt(selector.categories[l][t][e]);if(!u&0!==u)break;let g=selector.Powers[u];d++,m++,g&&(a++,o++,i++);let f=selector.pssa[1+u];n+=K(u,f,g,c),r.push(f);let p="Smilies"==s?140:229,y=selector.categories[l][t].length-3,h=Math.round(document.body.clientWidth/p);if(o==y&&y%h>0)for(;y%h>0;){n+="<div class='selectorPow' style='width: "+("Smilies"==s?130:parent.Classic?200:160)+"px; margin: 0 auto;'></div>",y++}}q(t+"ScCategory",n),e&&q(t+"ScContainer"," ["+o+"/"+m+"]")}e&&q(l+"Container"," ["+a+"/"+d+"]")}}if(!i)return addClass("d-none","flexy"),removeClass("d-none","nopowers"),addClass("d-none","searchBlock"),addClass("d-none","nopowersfound"),void addClass("d-none","nopowersmissing");V(),F(),removeClass("d-none","flexy"),addClass("d-none","nopowers"),function(){let e=xatdomain+"/images/smw/all/spritesheet.";function t(t){let s=document.createElement("img");s.src=e+"png?cb="+t.cachebust,s.Obj=t,s.onload=function(e){let t=e.target.Obj,o=document.querySelectorAll(".smwImage");for(let e=0;e<o.length;++e){let l=o[e].dataset.smw;t[l]?o[e].style.background="url("+s.src+") -"+t[l][0]+"px -"+t[l][1]+"px":(l="url('https://xat.com/images/smw/"+l+".png')",o[e].style.background=l)}}}function s(e){}loadJSON(e+"php",t,s)}(),Object.values(r).forEach((e=>{let t=document.getElementById(e+"Image");t&&t.addEventListener("click",$),c?(t=document.getElementById(e+"Switch"),t&&t.addEventListener("click",selector.clickSwitch)):(t=document.getElementById(e+"Text"),t&&t.addEventListener("click",N))})),document.querySelectorAll(".selectorPowText").forEach((e=>{e&&e.dataset&&e.dataset.smw&&addToolTip(e,e.dataset.smw,!0,"low")}))}}function F(e){if(!e)return;addClass("d-none","nopowersmissing"),addClass("d-none","nopowersfound");let t=document.querySelector("#search"),s=t&&":miss"==t.value.trim(),o=document.querySelectorAll("[data-sm]"),l=document.querySelector("#nopowers");l&&!l.classList.contains("d-none")||(o&&o.length==e?removeClass("d-none",s?"nopowersmissing":"nopowersfound"):addClass("d-none",s?"nopowersmissing":"nopowersfound"))}function G(e){let t=document.getElementById("searchopts");t.style.display="none"==t.style.display?"block":"none"}function _(e){document.getElementById("searchopts").style.display="none"}function H(e){e&&e.stopPropagation();let t=document.getElementById("search").value;t=t.replace(/\./g,":");let s=U(),o=z(t,s),l=e.currentTarget.id;"s_clear"==l?o={}:(l=l.split("_"),l[1]?o[l[1]]=l[2]:o[l[2]]=!o[l[2]]),t=W(o,s),document.getElementById("search").value=t,_(),selector.doPowers(t)}function U(){if(!selector.keys){let e=[],t=document.querySelectorAll(".searchopt");for(let s=0;s<t.length;++s){let o=t[s].id;o=o.split("_"),o[2]&&e.push([o[1],o[2]])}selector.keys=e}return selector.keys}function z(e,t){let s={};e=e.split(" ");for(let o in t)for(let l in e)if(e[l].includes(":")){let n=e[l].toLowerCase().split(":");if(t[o][0].startsWith(n[0])&&t[o][1].startsWith(n[1])){t[o][0]?s[t[o][0]]=t[o][1]:s[t[o][1]]=!0;break}}else s.s=e[l];return s}function W(e,t){let s="";for(let o in t){let l=t[o][0];l||(l=t[o][1]),"string"==typeof e[l]?e[l]==t[o][1]&&(s+=l+":"+e[l]+" "):e[l]&&(s+=":"+l+" ")}return e.s&&(s+=e.s),s}function K(e,t,s,o){if(void 0===t)return"";let l=t,n=!(selector.Mask&&selector.Mask[e>>5]&1<<e%32),a=parent.Classic?200:160;if(!o){if(!n)return"";s=1,a=130}l.length>7&&s>1&&(l=l.substr(0,7)+"..."),s>1&&(l+=" ["+s+"]");let r='<div id="'+t+'Container" class="selectorPow '+(s?"":"grayout")+'" data-sm="'+t+'" data-pn="'+e+'" style="width: '+a+'px;">\n<div id="'+t+'Image" class="selectorPowImage smwImage" data-smw="'+t+'" style="width: 30px; height: 30px;"></div>\n<div id="'+t+'Text" class="selectorPowText '+(s?"":"grayout")+'" data-smw="'+t+'">'+l+"</div>";return selector.Mask&&s&&o&&(r+='<div id="'+t+'Switch" class="selectorPowSwitch svgBack" data-pn="'+e+'" style="background-image: url('+(n?"svg/on.svg":"svg/off.svg")+');"></div>'),r+="</div>",r}this.doPowers=function(e){l&&l.classList.add("d-none"),this.Go&&(R=!1,e=this.initPowers());let t=U();e||(e="");let o=e;o=o.replace(/\./g,":");let n=z(o,t);if("Smilies"==s&&n.s.length<1&&(R=!1),n.s.length>2&&"Smilies"==s)!function(e){let t,s=[];selector.clear({Tabs:1,stiff:1,searchBlock:1});for(let t in selector.topsh){if(t.search(e)<0)continue;ee(selector.topsh[t])&&s.push(t)}t=selector.syel+","+selector.soth,t=t.split(",");for(let o in t)t[o].search(e)<0||s.push(t[o]);for(let t in selector.pssa){if(selector.pssa[t].toString().search(e)<0)continue;ee(xInt(t)-1)&&s.push(selector.pssa[t])}clearDiv("flexy");let o=clearDiv("stiff");for(let e in s)O(o,s[e],A)}(n.s);else{""===D||n.sort||(R=!1,D=""),n.sort||j(0,0,n,R);for(let e in t){let s;(n[s=t[e][0]]&&n[s]==t[e][1]||n[s=t[e][1]])&&j(s,n[s],n)}j("s",n.s,n),R||(R=!0),D=n.sort||""}};let X=!1;function J(e){X=!0;let t=e.target.value;selector.doPowers(t)}function V(){let e,t,s;for(let o in selector.categories){t=0;for(let l in selector.categories[o])e=0,s=document.getElementById(l+"ScCategory"),s&&(s.childNodes.forEach((function(t){"none"!==t.style.display&&t.dataset.pn&&e++})),s=document.getElementById(l+"ScContainer"),"standard"==o&&(e=1),s&&(s.style.display=e>0?null:"none"),t+=e);s=document.getElementById(o+"Container"),s&&(s.style.display=t>0?null:"none")}}function Y(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}function Z(e,t){return e[0]>t[0]?-1:e[0]<t[0]?1:0}function $(e){"Smilies"!=s?HitWiki(e.target.dataset.smw):N(e)}function Q(t){let o=(new Date).getTime();return t!=s&&(e=-1e6),s=t,o-e<500||(e=o,!1)}function ee(e){let t=0;e<0&&(t=1,e=-e);let s=e>>5;e<0&&(s=-1);let o,l=e%32;return o=t?xInt(selector.w_GroupPowers[s]):xInt(selector.w_Powers[s]),0!=(o&1<<l)}this.clickSwitch=function(e){if(!selector.Mask)return;let t=e.target.style.backgroundImage.includes("svg/on.svg");e.target.style.backgroundImage=t?"url(svg/off.svg)":"url(svg/on.svg)";var s={Page:"selector",Command:"SetPower"};let o=e.target.dataset.pn;selector.Mask[o>>5]=selector.Mask[o>>5]&~(1<<o%32)|(t?1:0)*(1<<o%32),s.Value=t?1:0,s.Id=e.target.dataset.pn,selector.ReLogin=!0,ToC(s)};let te=document.getElementById("SmBut");te&&te.addEventListener("click",this.startSmilies);let se=document.getElementById("StickBut");se&&se.addEventListener("click",this.stickers);let oe=document.getElementById("KissBut");oe&&oe.addEventListener("click",(()=>{selector.clear({Tabs:1}),this.doKisses()}));let le=document.getElementById("GiftsBut");function ne(){window.parent.setFrameVis()}function ae(e){let t=window.parent.document.getElementById("FrameDialogTitle");t?(window.parent.clearDiv(0,t),window.parent.addText(t,e)):addTitleBar(e,"",null,!0,ne)}function re(e,t){let s=document.querySelector(t?"#"+t:"#loading");s&&(e?(s.classList.remove("d-none"),s.innerHTML='<div id="xatLoader"><div id="xatLoaderInner"><img id="planet" src="svg/x.svg"><img id="rocket" src="svg/ss.svg"></div></div>'):(s.classList.add("d-none"),s.innerHTML=""))}function ie(){let e=document.querySelector(".walletInfos"),t=document.querySelector("#wallet_days"),s=document.querySelector("#wallet_xats");if(e&&t&&s){let o=selector.MainObj;if(!o)return;if(o=o.main,o.length){let l=null;for(let e in o)o[e].name&&o[e].name.match(/\d+/g)&&(l=o[e].name);if(l){l=l.split(", "),s.innerHTML="",t.innerHTML="";let o=makeElement(s,"img");o.src="svg/actBuyXats.svg",o.style.width="30px",makeElement(s,"span").innerHTML=l[0];let n=makeElement(t,"img");n.src="svg/star.svg",n.style.cssText="width:30px;vertical-align:-8px!important",makeElement(t,"span").innerHTML=l[1],e.classList.remove("d-none")}}}}le&&le.addEventListener("click",(()=>{this.gifts()})),this.clear=function(e){e||(e={}),clearDiv("flexy"),clearDiv("stiff");const t=["AreYouABot","SignUp","LoginRegEtc","LoginForm","ResetPassword","RegisterOK","LogoutOK","RegisterDialog","stiff","flexy","nopowers","nopowersfound","nopowersmissing","messageBlock","Tabs","searchBlock","stickMessageBlock","FrontId"];for(let s in t){let o=t[s];e[o]?(removeClass("d-none",o),parent.removeClass("d-none","Overlays")):addClass("d-none",o)}removeClass("active","SmBut"),removeClass("active","KissBut"),removeClass("active","StickBut"),removeClass("active","GiftsBut"),modalClose(),x()},this.GetXconst=function(e,t){let o;try{o=JSON.parse(t)}catch(e){o=t}if(this[e]=o,"end"==e)switch(s){case"Smilies":selector.doSmilies();break;case"Powers":selector.doPowers();break;case"Sticker":re(!0),loadJSON(chatUrl+"sticker.php?a=1",I);break;case"Kiss":selector.doKisses2();break;case"Gifts":selector.gotGifts1();break;case"BuyGifts":loadJSON("https://xat.com/web_gear/chat/gift2.php?v2=1",m)}},this.hideWallet=function(){let e=document.querySelector(".walletInfos");e&&e.classList.add("d-none")},this.initLang=function(e){}};xrRoot.selector=selector;