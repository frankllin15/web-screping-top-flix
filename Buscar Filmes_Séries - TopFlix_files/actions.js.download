"use strict";var CurrentSec,actions=new function(){var e,t,a,n,o,i,s,l,r,d,c,m=["Actions","Powers"],u="Actions",g=0,f=[],p=!1,v=1,y=!1;function h(){if("profile"==ThisPage){y=config.NotLoggedIn;var e="Edit";p&&(e="Done"),y&&(e=""),"Profile"!=u&&"xatme"!=u&&(e="");var t=e;e&&(t=["mob1."+e.toLowerCase(),e]),addTitleBar(["mob1.me","Me"],y?["mob1.login","Login"]:["mob1.logout","Logout"],y?actions.doLoginDialog:C,t,actions.EditClick),config.PhoneType==PhoneTypes.IPHONE&&function(e){if("actions"==ThisPage)return;if(e===v)return;v=e,""==e&&(e=0);if("Done"==e)return;ToC({name:"SetEditButton"+e})}(e)}}function E(){actions.Visible=!1,parent.setFrameVis(),modalClose()}function T(e,t){switch(sendFunc=actions.sendApp,"Transfer"==e&&(e="NTransfer"),e){case"PrivateMessage":return void(r?(setPmMode(!0,a.user[0].id,a.user[0].regname,parent.document),E()):actions.locDoModal(a[e]));case"Transfer":case"AddAsFriend":return void actions.locDoModal(a[e]);case"Divorce":case"Marry":return void parent.classicSetDialog("selector",{Type:e,MainObj:a.user[0]});case"doBan":case"doKick":i=t,actions.locDoModal(e),addText(document.getElementById("BanName"),t.label);var n=document.getElementById("DoIt");return addText(n,t.label),n.addEventListener("click",(function(e){actions.doBan(e)})),void("Boot"!=t.Type&&setTextNode("BootToRow",""))}var o=clearDiv(l),d=makeElement(o,"div","table");if(t&&("$Ban"==t.action||"$Kick"==t.action||"$Transfer"==t.action)&&(addClass("d-none","avatarPosLeft"),addClass("d-none","infoCell"),addClass("d-none",0,c),addClass("d-none","statusNewPar"),"$Transfer"!=t.action&&addClass("d-none","walletUser"),"$Transfer"==t.action&&(document.getElementById("KickBan").innerHTML=HiddenDivs.doTransfer),["$Kick","$Ban"].indexOf(t.action)>=0&&(document.getElementById("KickBan").innerHTML="$Ban"==t.action?HiddenDivs.doBan2:HiddenDivs.doKick2,"$Kick"==t.action&&"function"==typeof parent.hasPower&&!parent.hasPower(25)&&!s))){let e=document.getElementById("bootOut"),t=document.getElementById("BootTo");t.disabled=!0,t.style.backgroundColor="#e8e8e8",e.style.pointerEvents="none",addToolTip(e,["mob2.reqboot","Requires Boot power"],!0,"low")}if(d.style.width="100%",s){var m=document.getElementById("infoCell");m.style.width="50%",m.style.textAlign="center"}var u,g=1,p=0,v=[];for(var y in f.push(e),"NTransfer"==e&&(e="Transfer"),a[e]){var h=!1;switch((u=a[e][y]).type){case"title":if("Transfer"==e)continue;addEditBox(o,0,u.name,"noedit","bold");break;case"password":if("Transfer"==e)continue;addEditBox(o,u.id,u.name,0,0,"password");break;case"dialog":if("Transfer"==e)continue;addEditBox(o,u.id,u.name);break;case"text":if("Transfer"==e&&u.name.indexOf(",")>=0)actions.buildWallet(u.name);else{n=document.getElementById("xatsdays");addEditBox(n,0,u.name,"noedit")}break;default:u.row>g&&b(d),v.push(u),2==++p&&b(d),h=!0}h||b(d)}(p&&b(d),a.Ban&&a.Ban.length>14)&&(v=[{action:"",label:""}],b(d).style.cssText="visibility: hidden");if(r&&parent.classicSetHeight){parent.classicSetHeight(o.clientHeight);var T=document.body.scrollHeight;s&&T&&T<401&&(document.body.style.fontSize=T/401*.85+"rem")}function b(e){if(!(v.length<1)){var t=makeElement(e,"div","row");return function(e,t){x(e,t[0],!0,!1),x(e,t[1],!1,!0),x(e,t[2])}(t,v),p=0,v=[],g++,t}}}function b(e,t){var a,n,o=makeElement(e,"div","butcontainer");o.style.cssText="position: relative; background-color: #"+(hasDarkMode()?"313131":toHex6(config.ButCol)),parent.Classic||(o.style.backgroundImage="none");var i,s=makeElement(o,"div","butlayout butcontent");s.style.cssText="padding: 0.4rem; font-size:0.85rem; color:#"+(hasDarkMode()?"969696":toHex6(config.ButColW)),(n=makeElement(s,"div","table")).style.cssText="width:100%",a=makeElement(n,"div","cell"),t.Power?((i=makeElement(o,"div","")).style.cssText="position: absolute; top:0; left:0; padding:0.15rem;",makeElement(i,"div","svgBack").style.cssText=" width:1.6rem; height:1.6rem; background-image:url(/images/smw/"+t.icon.toLowerCase()+".png); "):(t.icon,t.icon&&((i=makeElement(o,"div","")).style.cssText="position: absolute; top:0; left:0; padding:0.15rem;",makeElement(i,"div","svgBack").style.cssText=" width:1.6rem; height:1.6rem; background-image:url(svg/act"+t.icon+".svg); "));var l=t.label;return(a=makeElement(n,"div","cell")).style.width="100%",void addText(a,l)}function x(e,t,n,o){if(t){var i,s=.25,l=.25;n&&(l=.5),o&&(s=.5),(i=makeElement(e,"div","cell")).style.cssText="width:50%; padding: 0.25rem "+s+"rem 0.25rem "+l+"rem;";var r=t.action;if("$"==r.charAt(0)&&(r=r.substr(1)),a&&a.user[0]&&!a.user[0].regname&&["Powers","Divorce","Marry","BFF"].indexOf(r)>=0&&(t.flags=268435454&t.flags|1),"GetXats"==r){let e="";switch(t.icon){case"Marry":e=["mob2.needxats","You need 200 xats to Marry or BFF"];break;case"Transfer":e=["mob2.needxatstr","You need xats or days to transfer"]}e&&(addToolTip(i,e,!0,"low"),t.flags=268435454&t.flags|1)}i.id="act_"+r,i.flags=t.flags,1&t.flags&&(i.style.opacity="0.5"),i.onclick=function(e){1&i.flags||actions.sendApp(e,t)},t.divcol=i,b(i,t)}}function w(e,t){for(var a=t.childNodes,n=0;n<a.length;n++)"TEXTAREA"!=a[n].nodeName&&"INPUT"!=a[n].nodeName||!a[n].id||(e[a[n].id]=a[n].value),w(e,a[n])}this.main=function(e){xatMain(e),r=1&config.Flags,setdarkmode(),p=!1,v=null,n=null,u=m[0],actions.Repaint(),r||AddHammer(document.body,Hammer.DIRECTION_RIGHT,this.sendApp),document.body.style.display="block",doZap(10),window.addEventListener("orientationchange",(function(e){actions.Repaint()}),!1),TranslateAll(),document.getElementById("topSelector").style.display="none",document.getElementById("openModal"),r||parent.SetPow()},this.Repaint=function(){if(!a||"Profile"==u||"Actions"==u){var e=!(90==window.orientation||-90==window.orientation);e!==n&&(n=e)}},this.EditClick=function(e){p=1===e||0===e?0!=e:!p,"profile"==ThisPage&&("Profile"!=u||(p?actions.doProfileDialog():modalClose()))},this.doBan=function(e){var t,a=["Duration","BootTo","Reason","ReasonKick"];for(var n in a)(t=document.getElementById(a[n]))&&(i[a[n]]=t.value);i.ReasonKick&&(i.Reason=i.ReasonKick),i.action=i.Type,actions.sendApp(e,i)},this.sendApp=function(e,t,n){var i;switch(e&&e.stopPropagation(),null!==t&&"object"==typeof t?(i=t.icon?t.action:t.Type,n=t.Power):i=t,i){case"Login":return r?void window.open("/login","_top"):void actions.doLoginDialog();case"BuyXats":return void window.open("/buy","_blank");case"Store":return void(xrRoot.xrAndroidApp||xrRoot.xrIOSApp?xrRoot.actSetPage("store"):window.open("/powers","_blank"));case"Settings":return void parent.classicSetDialog("settings",config.MyId);case"Powers":return P(),void parent.classicSetDialog("selector",{Type:"Powers",UserNo:config.MyId,Powers:d,MainObj:a});case"Gifts":return parent.setAppIcon(20044),void parent.classicSetDialog("selector",{Type:"Gifts",MainObj:a,Config:config});case"ClassicCancel":return void parent.classicSetDialog("profile",config.MyId);case"Edit":return void actions.doProfileDialog()}switch(i){case"Settings":return void parent.classicSetDialog("settings",config.MyId);case"location":ToC({Command:"StartGroup",Group:n});break;case"swiperight":case"GoBack":if(config.roomid==IDLE_ROOM)return;var s={Command:"GoBack"};"visitors"==config.PrevPage||"messages"==config.PrevPage?s={Command:"NOP",Next:config.PrevPage}:"visitors"!=config.PrevPage2&&"messages"!=config.PrevPage2||(s={Command:"NOP",Next:config.PrevPage2}),ToC(s);break;case"Divorce":case"Marry":case"Transfer":case"BFF":case"PrivateMessage":let e=document.querySelector("#transferror");s={name:i,UserNo:g,Power:n,Page:"actions",Command:"Action",Next:"messages"};var l,m=["Message","Password","Xats","Days"];for(var u in m)(l=document.getElementById(m[u]))&&(s[m[u]]=l.value);if("Transfer"==i&&r){let t=actions.handleTransferForm(s);if(actions.setTransferErr(e,""),t)return e.style.display="inline-block",actions.setTransferErr(e,t)}ToC(s),E();break;case"Actions":case"Profile":SetSection(i),actions.configurePage(),p=!1,h();break;case"xatme":s={UserNo:g,Next:"xatme",Command:"Xatme",name:"Xatme"};ToC(s);break;case"Powers":SetSection(i),P(),loadJSON(xatdomain+"/json/powers.php",(function(e){!function(e){var t,n=[],i=0,s=L();(o=makeElement(s,"div")).id="ScrollContainer",o.className="xscrollContainer",o.style.top=document.getElementById("titleBar").clientHeight+document.getElementById("topSelector").clientHeight+"px",o.style.bottom="0px",o.addEventListener("scroll",onMessagesScrollEventHandler,!1);var l=makeElement(o,"ul");l.style.cssText="display: flex;flex-wrap: wrap;";for(var r=0,c=0;c<9999&&(n[c]=e[c],null==n[c]?i++:(i=0,n[c].id=c),!(i>10));c++);if(I)for(var c in I)n[c]={},n[c].id=c,n[c].s=I[c];n.sort((function(e,t){return e.s.localeCompare(t.s)})),t=l;var m,u,g=a.PowersMask;g&&(g=g[0]);for(var c in n)if(void 0!==n[c]&&(!d||(m=d[n[c].id]))){u=m=xInt(m),m<1&&(m=" "),r++;var f=makeElement(t,"li","friend");iidLine++,f.setAttribute("data-line",iidLine),LineVisible=0,f.setAttribute("data-visible",LineVisible),f.style.cssText="flex: 1 0 41%; margin: 10px;";var p=makeElement(f,"div","listTable"),v=makeElement(p,"div","dialogRow"),y=makeElement(v,"div","dialogCell dialogCellMiddle"),h=makeElement(v,"div","dialogCell cellWide noPointer"),E=makeElement(v,"div","dialogCell dialogCellMiddle"),T=makeElement(v,"div","dialogCell dialogCellMiddle");if(LoadImage(y,xatdomain+"/images/smw/"+n[c].s+".png","avatar",32,e),addText(h,n[c].s),addText(E,m),g&&u){var b=n[c].id,x=makeElement(T,"img",0,"m"+b);x.height=24,g[b>>5]&1<<b%32?x.src="svg/off.svg":x.src="svg/on.svg",f.pid=b,f.onclick=function(e){actions.doFav(e,this.pid)}}}zapTimeout=setTimeout(doZap,10),0==r&&l.appendChild(MakeHelpMessage(TransText("mob2.nopowers","No powers or out of days")))}(e)}),(function(e){})),p=!1,h();break;case"Gifts":SetSection(i),loadJSON(xatdomain+"/web_gear/chat/gifts.php?id="+g,(function(e){GiftsLoaded(e)}),(function(e){})),p=!1,h();break;case"Cancel":clearDiv("KickBan"),removeClass("d-none","avatarPosLeft"),removeClass("d-none","infoCell"),removeClass("d-none",0,c),f.pop(),T(f.pop());break;default:if("$doBan"==i||"$doKick"==i){i=t.Type,n=t.Power;let e,a=["Duration","BootTo","Reason","ReasonKick"];for(let n in a)e=document.getElementById(a[n]),e&&(t[a[n]]=e.value);t.ReasonKick&&(t.Reason=t.ReasonKick)}if("$"==i.charAt(0))T(i.substr(1),t);else{switch(w(s={name:i,UserNo:g,Power:n,Page:"actions",Command:"Action"},document.getElementById("all2")),s.name){case"Powers":case"Gifts":s.LastActionHero=t.name,s.SavedId=t.UserNo,s.Next="actions",s.Command="";break;case"PrivateChat":s.Next="messages";break;case"OK":actions.saveProfile();case"Cancel2":return void E();default:r||(s.Next="pop"),s.Duration=t.Duration,s.Reason=t.Reason,s.BootTo=t.BootTo}if(ToC(s),"PrivateChat"==s.name&&r){var v=window.parent.document.getElementById("friendsList");v&&(v=v.classList.contains("active")),v&&window.parent.openList("","visitors",0)}"actions"!=s.Next&&E()}}},this.handleTransferForm=function(e){if("object"!=typeof e)return!1;if(!e.Password)return["mob2.transfPassword","You must set a password"];if(""!=e.Xats){if(parseInt(e.Xats)<10)return["mob2.transf10xats","You must send at least 10 xats"]}if(""!=e.Days){if(parseInt(e.Days)<1)return["mob2.transf1day","You must send at least 1 day"]}return""==e.Xats&&""==e.Days&&["mob2.transfernothing","You must send at least 1 day or 10 xats"]},this.setTransferErr=function(e,t){e&&(e.innerHTML=""),addText(e,t)},this.clearall=function(){modalClose(),a=null;var e=clearDiv("avatarid");e&&e.parentNode.removeChild(e),e=null,L()},this.configurePage=function(e){if(!actions.Visible)return;if(console.log("json:",e),e&&(LineVisible=1,a=JSON.parse(e),CacheHiddenDivs()),a.main)for(let e in a.main){let t=a.main[e];if(t&&5==t.row){e=parseInt(e);let t=a.main[e+1];t&&(t.row="5")}}c&&(clearDiv(c),c&&c.remove()),c=null;var t=L();if(!xrRoot.MyId)return void xrRoot.selector.DoLoginEtc("SignUp");if(!a.user)return;if(!r&&y)return;var n=a.user[0];s="1"==n.me;let o=g=n.id.toString();"000000000"==o.substr(-9,9)?o=o.substr(0,o.length-9)+"B":"000000"==o.substr(-6,6)&&(o=o.substr(0,o.length-6)+"M");var i=n.regname.length<1?actions.IsToonsNoId(o)?"":o:n.regname.replace(/l/g,"L")+" ("+o+")";if(t.innerHTML=s?HiddenDivs.PictureAndNameEdit:HiddenDivs.PictureAndName,r){if((U=window.parent.document.getElementById("FrameDialogTitle"))&&(U.removeAttribute("data-localize"),clearDiv(0,U),addText(U,i),removeClass("d-none",0,window.parent.document.getElementById("FrameDialog")),removeClass("d-none",0,window.parent.document.getElementById("FrameBack")),s)){var d=U.parentNode.parentNode,m=xInt(d.style.width)+2*xInt(d.style.left);d.style.left=xInt(.05*m)+"px",d.style.width=xInt(.9*m)+"px"}}else addTitleBar(i,"",null,!s||"",s?null:E),this.Name=i;n.name=n.name.replace(/_+/g," "),n.status=n.status.replace(/_+/g," ");var u=ProcessName(n.name,n.status,n.pFlags),f=document.getElementById("name");f.innerHTML="";var p=makeElement(f,"div");if(s?u.name=u.name.substr(0,90):(u.name=u.name.replace(/\s*\(.*?\)\s*/g,""),u.name=u.name.substr(0,30)),u.name.length){v=createSmText2(u,"name",void 0,void 0,268435456|n.pFlags);p.appendChild(v),setValue("nameedit",n.name)}else{let e=document.getElementById("name");var v=makeElement(e,"span");p.innerHTML=n.regname,p.appendChild(v),setValue("nameedit",n.name)}if(u.status){const e=n.Statusfx?n.Statusfx.replaceAll("#","").split(","):[],t=e.length?xInt(e[0]):0,a={};try{a=e.length?JSON.parse(decodeURIComponent(escape(atob(e[1])))):{}}catch(e){}let o=u.status.substr(0,128);if(s){const e=document.getElementById("status");makeElement(e,"p",null,"statusText"+n.id),e.style.cssText="font-size:0.66rem;margin-top:-3px;padding-left:0px;";void 0!==u.statusglow&&(e.style["text-shadow"]=MakeGlow(u.statusglow)),void 0!==u.statuscol&&(e.style.color="#"+toHex6(u.statuscol));createStatusfx(o,a,n.id,t,"translucent"==a.effect?u.statusglow:null);t&&(e.style.width="115%",e.style.display="block",e.style.overflow="hidden",e.style.position="relative")}else if(s){let e=document.getElementById("status");addText(e,o),e.className="mobStatus"}else{document.getElementById("statusNewPar").className="statuspar";let e=document.getElementById("statusNew");e.className="statuschild",e.innerHTML=o}}if(s){var h=u.status.substr(0,120);h||h.length||(document.getElementById("name").style.paddingTop="1rem")}if("function"==typeof parent.hasPower&&!parent.hasPower(54)&&s){let e=document.getElementById("statOut");document.getElementById("statusedit").disabled=!0,addToolTip(e,["mob2.reqstatus","Requires Status power"],!0,"low"),n.status&&setValue("statusedit",n.status)}else setValue("statusedit",n.status);!s&&!actions.IsToonsNoId(n.id)&&n.regname.length&&"function"==typeof parent.isConnected&&parent.isConnected()&&setTimeout((()=>{let e=document.getElementById("act_Powers");e&&e.flags&&1&e.flags&&(e.flags=268435454&e.flags|0,e.style.opacity=1)}),6e4);var b=n.on;let x=n.on2.replace(/`/gi,'"');try{x=JSON.parse(x)}catch(e){x=!1}if(s)0;else{var w="";if(x){b="";let e=x.friend?x.friend.split(";="):[],t=e[0]||!1,a=e[1]||!1;a&&t&&(b+=t+" "),x.online&&(b+=x.online+" "),x.rank&&(b+=x.rank+" "),x.other&&(b+=x.other+" "),x.Locating||actions.IsToonsNoId(n.id)||(a&&(b+=a+" "),!a&&t&&(b+=t+" "))}if(n.location){var I=n.location.substr(1);if("@"!==n.location.charAt(0))b+=" "+n.location;else{let e=parent.defconfig;if(e.GroupName||(e.GroupName=""),I.toLowerCase()!=e.GroupName.toLowerCase()){w=makeElement(0,"a");var B=n.location.replace(/[^a-zA-Z0-9_@ ]/g,"");w.href="/"+B.substr(1),w.target="_blank",addText(w,B)}}}setTextNode("on",b+" ",w),document.getElementById("on").style.cssText="font-size: 12px; color: #5f5f5f;",document.getElementById("labelname").style.display="none",document.getElementById("labelon").style.display="none"}var k=a.main[0];k&&(k=k.name),k&&actions.buildWallet(k);let C=document.getElementById("profileIcons");C.style.marginTop="5px",C.style.display=s?"inline":"grid";let P=makeElement(C,"span");function N(){if(x){if(x.reg){let e=makeElement(P,"a");e.style.marginLeft="-1px",makeElement(e,"img").src="svg/registered.svg",addToolTip(e,["mob2.reg","Registered"],!0,s?"left":"low")}if(x.sub){let e=makeElement(P,"a");e.style.marginLeft="-1px",makeElement(e,"img").src="svg/subscriber.svg",addToolTip(e,["mob2.sub","Subscriber"],!0,s?"left":"low")}if(x.married){let e=x.married.split(","),t=e[1]||"",a=e[2]||"";a=parseInt(a);let n=makeElement(P,"a");n.style.marginLeft=s?"2px":"-1px",makeElement(n,"img").src="svg/heart2.svg";let o=!isNaN(a)&&new Date(1e3*a).toISOString().substr(0,10);t&&n.addEventListener("click",(()=>{parent.openInNewTab("https://xat.me/i="+t)})),addToolTip(n,o?["mob2.marriedtosince","Married to: $1, Since: $2",t,o]:["mob2.marriedto","Married to: $1",t],!0,s?"left":"low")}if(x.bff){let e=x.bff.split(","),t=e[1]||"",a=e[2]||"";a=parseInt(a);let n=makeElement(P,"a");n.style.marginLeft=s?"2px":"-1px";let o=makeElement(n,"img");o.src="svg/bff.svg",o.style.width="17px";let i=!isNaN(a)&&new Date(1e3*a).toISOString().substr(0,10);t&&n.addEventListener("click",(()=>{parent.openInNewTab("https://xat.me/i="+t)})),addToolTip(n,i?["mob2.bfftosince","BFF to: $1, Since: $2",t,i]:["mob2.bffto","BFF to: $1",t],!0,s?"left":"low")}let e=function(e){if(!e)return!1;let t=e.married?e.married:e.bff;if(t){let e=t.split(",");if(!e[2])return!1;if(e[2]=parseInt(e[2]),isNaN(e[2]))return;let a=new Date,n=new Date(1e3*e[2]);if(a.getMonth()==n.getMonth()&&a.getDate()==n.getDate()&&a.getFullYear()!=n.getFullYear()){return a.getFullYear()-n.getFullYear()}}return!1}(x);if(e){let t=makeElement(P,"span");addText(t,["mob2.anniversary","Happy $1 Anniversary!",e]),t.className="anBlink",s||(t.style.cssText="float: none; vertical-align: middle;")}}if(n.homepage){setValue("homepageedit",n.homepage);let e=parent.WordIsLink(n.homepage);if(e){let t=makeElement(P,"a");t.style.marginLeft=s?"2px":"-1px";let a=makeElement(t,"img");a.src="svg/home.svg",a.style.width="22px",addToolTip(t,n.homepage,!0,s?"left":"low"),t.addEventListener("click",(t=>{parent.LinkValidator(t,e)}))}}if(!s&&a.user[0].regname){let e=makeElement(P,"a"),t=makeElement(e,"img");t.src="svg/gifts2.svg",t.style.marginTop="1px",addToolTip(e,["box.257","Gifts"],!0,"low"),e.addEventListener("click",(()=>{parent.setAppIcon(20044),parent.classicSetDialog("selector",{Type:"Gifts",MainObj:a})}))}}P.className="profileIc",x.Locating||s||N(),s&&N(),setValue("avataredit",n.avatar);var D=!1,S="avatarPosLeft";l="buttonsBot",document.getElementById("butLeft").style.cssText="width: 100%;",document.getElementById("infoCell").style.cssText="width: 100%;",document.getElementById("infoCell").className="cell profileInfo shadTxtClassic",T("main");var M,A,R,H=n.avatar,O=document.getElementById(S),F=makeElement(O,"div");if(s){M=R=30;let e=Pickr.create({el:"#nameColor",theme:"nano",preview:!0,useAsButton:!0,closeOnScroll:!0,lockOpacity:!0,components:{palette:!0,preview:!0,opacity:!0,hue:!0,interaction:{save:!0,copy:!0,input:!0}}}).on("save",(t=>{let a=document.createElement("textarea");a.value=t.toHEXA().toString(),document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),e.hide()})).on("show",(()=>{let e=GetTranslation("mob2.copycolor");e||(e="copy color");const t=document.querySelectorAll(".pcr-save");t[t.length-1].value=e}));parent.addEventListener("click",(()=>{e.hide()}),!1);let t=document.getElementById("colorWheel");parent.Classic||(t.style.marginTop="-1px"),addToolTip(t,["mob2.colorpicker","Color Picker"],!0,"left")}else s?(O.style.cssText="height: 100%; padding: 0.4rem;",F.style.cssText="height: 100%;",M=F.clientHeight-12,R=xInt(.5*(document.body.clientWidth-24)*1)):M=R=75;M>R&&(M=R),A=M,"("==H.charAt(0)?A=calcStripSize(M):(A=calcAvSize(M),H>0&&A>30&&(A=30));var X=document.getElementById(S);let $=makeElement(X,"div","buttonimg");O.style.cssText=s?"padding: 0 5px 0 0;":"padding: 0.5rem; padding-bottom: 3.5rem;",F.style.cssText="width:"+M+"px",document.getElementById("botPad").style.cssText="height: 100%;",document.getElementById("tgreen").style.height="auto",document.getElementById("tgreen").parentNode.style.height="auto",c=makeElement(document.body,"div","profileAvatar","avatarid"),makeElement(c,"div","buttonimg").pFlags=n.pFlags,$.pFlags=n.pFlags;var G=O.offsetLeft;G="4.5px";var K,U,z=O.offsetTop+6+"px";if(c.style.cssText="position: absolute; left: "+G+"; top: "+z+"; width: "+M+"; height: "+M+"; z-index: -1;",LoadImage($,H,"buttonimg",xInt(A),0,M/A,!0),$.style.cursor="pointer",a.user[0].regname&&($.holder.onclick=function(e){HitWeb("https://xat.me/"+a.user[0].regname)}),s)for(K in{name:1,avatar:1,status:1,homepage:1})(U=document.getElementById(K+"edit"))&&(U.onblur=function(e){actions.DoBlur(e)})},this.DoBlur=function(e){var t=a.user[0];if((e=e.currentTarget).id){e.id.substr(e.id.length-4);t[e.id.substr(0,e.id.length-4)]=e.value,actions.configurePage()}},this.updatePC=function(e){var t=["PrivateChat","PrivateMessage"],a=e?0:1;for(var n in t){var o=document.getElementById("act_"+t[n]);o&&(o.flags=268435454&o.flags|a,o.style.opacity=a?"0.5":"1")}},this.doBuyXats=function(e){ToC({Command:"Action",name:"MakePurchase",N:e}),E()},this.BuyXatsDialog=function(e){var t=JSON.parse(e);actions.locDoModal("BuyXatsDialog");var a,n,o,i,s=[],l=[],r=document.getElementById("BuyTable");for(var d in t)"i"==d.charAt(0)&&"N"==d.charAt(1)&&(n=xInt(d.substr(2)),a=t[d],s[n]=t["iD"+n],l[n]=a);for(n in s)(i=makeElement(r,"div","dialogRow")).xats=l[n],i.onclick=function(e){actions.doBuyXats(this.xats)},(o=makeElement(i,"div","dialogCell cellWide")).setAttribute("style","text-align:center"),makeElement(o,"span"),o.setAttribute("style","color:#02a9d2"),o.innerHTML=s[n]},this.LoginCancel=function(){modalClose(),y&&actions.doLoginDialog()},this.Logout=function(){var e={Page:"profile",name:"Logout",Command:"Action",Next:"profile"};return ToC(e),!1},this.Login=function(){var e=document.getElementById("openModal");e&&(e.style.visibility="hidden");var t={Page:"profile",Command:"Login"};return t.Username=document.getElementById("lusername").value,t.Password=document.getElementById("lpassword").value,FillInAll(t,["Username","Password"])&&ToC(t),!1};var I,B=/[^0-9A-Za-z]/g,k=/[^0-9A-Za-z\.\-@_]/g;function C(){actions.locDoModal("LogoutOK")}function P(){d=[];var e=a.AllPowers[0];for(var t in e)for(var n=32*t,o=0;o<32;o++)e[t]&1<<o&&(d[n+o]=1);if(a.Collections&&(I=a.Collections[0]),I)for(var t in I)d[t]=I[t];var i=a.PowersOflo;if(i&&(i=i[0]),i&&(i=i[0]),i){var s=i.split("|");for(o=0;o<s.length;o++){var l=s[o].split("="),r=xInt(l[1]);0==r&&(r=1),d[l[0]]=1+r}}}function L(){var e=clearDiv("all2");return DumpMemory(0),e}this.Register=function(){var a={Page:"profile",Command:"Register"};return a.Username=document.getElementById("rusername").value,t=a.Password1=document.getElementById("rpassword1").value,e=a.Email=document.getElementById("remail").value,FillInAll(a,["Username","Password1","Email"])&&ToC(a),!1},this.forgotPass=function(e){var t,a=document.getElementById("lusername");if(a||(a=document.getElementById("lemail")),a&&(a=a.value.toLowerCase()),e&&(t=e),e&&"{"==e.charAt(0)){var n=JSON.parse(e);if(n.html)return actions.doLoginDialog(),AlertMessage(n.html,1),void(a&&(document.getElementById("lusername").value=a));t=""}actions.locDoModal("ResetPassword"),t&&AlertMessage(t,1),a&&(document.getElementById("lemail").value=a)},this.ResetPassword=function(){var t={Page:"profile",Command:"ResetPassword"};return e=t.Email=document.getElementById("lemail").value.toLowerCase(),FillInAll(t,["Email"])&&ToC(t),!1},this.RegisterError=function(e){if("{"==e.charAt(0)){actions.locDoModal("RegisterOK");var t=JSON.parse(e);e=t.html,t.html="",t.Page="profile",t.Command="SetUserId",ToC(t)}document.getElementById("RegErr").innerHTML=e},this.doRegisterDialog=function(e){actions.locDoModal("RegisterDialog"),e&&((e=JSON.parse(e)).RegisterName&&(document.getElementById("rusername").value=e.RegisterName),e.RegisterPass&&(document.getElementById("rpassword1").value=e.RegisterPass),e.RegisterEmail&&(document.getElementById("remail").value=e.RegisterEmail)),document.getElementById("rpassword1").onkeyup=function(e){return restrictCharacters2(e,B)},document.getElementById("remail").onkeyup=function(e){return restrictCharacters2(e,k)}},this.LoginSetName=function(){e&&e.length>0&&(document.getElementById("lusername").value=e),t&&t.length>0&&(document.getElementById("lpassword").value=t)},this.doProfileDialog=function(){actions.locDoModal("EditProfileDialog");var e=a.user[0];document.getElementById("iname").value=e.name,document.getElementById("iavatar").value=e.avatar,document.getElementById("istatus").value=e.status,document.getElementById("ihomepage").value=e.homepage},this.doLoginDialog=function(e){xrRoot.selector.DoLoginEtc("LoginForm")},this.quitEdit=function(){var e={name:"SetEditButtonEdit"};ToC(e),modalClose()},this.saveProfile=function(){var e={Page:"profile"};return e.name=e.Type=e.Command="SaveXatspace",e.Name=document.getElementById("nameedit").value,e.Avatar=document.getElementById("avataredit").value,e.status=document.getElementById("statusedit").value,e.HomePage=document.getElementById("homepageedit").value,ToC(e),!1},this.termsOfService=function(){HitWeb("/terms?m=1")},this.doFav=function(e,t){var n={Page:"profile",Command:"SetPower"},o=a.PowersMask[0],i=document.getElementById("m"+t);e&&e.stopPropagation();var s=0;i.src.search("svg/off.svg")>=0?i.src="svg/on.svg":(i.src="svg/off.svg",s=1),o[t>>5]=o[t>>5]&~(1<<t%32)|s*(1<<t%32),n.Value=s,n.Id=t,this.ReLogin=!0,ToC(n)},this.getMe=function(){return s},this.IsToonsNoId=function(e){return(e=parseInt(e))>=19e8},this.checkIfButtons=function(){let e=document.querySelectorAll(".butcontainer"),t=document.querySelector("#walletUser"),a=document.querySelector("#statusNew");a=a&&a.innerHTML;let n=!1;return e&&(e.length<=8||2==e.length||e.length>=12)&&(n=!0),[s,n,t&&t.hasChildNodes(),e,a]},this.buildWallet=function(e){if(!e)return;let t=e.split(", "),a=s?document.getElementById("on"):document.getElementById("walletUser");s||(a.innerHTML=""),r||s||!a||a.classList.add("walletUserMobile");let n=makeElement(a,"span");s||(n.style.cssText="position: relative; left: 7px; bottom: 10px; font-size: 14px;");let o=makeElement(n,"img");o.src="svg/actBuyXats.svg",o.width="18",o.style.margin="0 3px 0 -2px";let i=makeElement(n,"span");i.innerHTML=t[0],i.className="meWallet";let l=makeElement(a,"span");s?l.style.marginLeft="10px":l.style.cssText="position: relative; right: 10px; bottom: 10px; float: right; font-size: 14px;";let d=makeElement(l,"img");d.src="svg/star.svg",d.width="18",d.style.margin="-4px 3px 0 0";let c=makeElement(l,"span");c.innerHTML=t[1],c.className="meWallet"};var N={LoginCancel:function(){actions.LoginCancel()},forgotPass:function(){actions.forgotPass()},doRegisterDialog:function(){actions.doRegisterDialog()},Logout:function(){actions.Logout()},termsOfService:function(){actions.termsOfService()},doLoginDialog:function(){actions.doLoginDialog()},Register:function(){actions.Register()},getXats:function(){getXats()},quitEdit:function(){actions.quitEdit()},saveProfile:function(){actions.saveProfile()},clearLogin:function(){clearAlertMessage(),actions.Login()},LoginAndSetName:function(){actions.doLoginDialog(),actions.LoginSetName()},clearResetPassword:function(){clearAlertMessage(),actions.ResetPassword()},modalClose:function(){modalClose()}};this.locDoModal=function(e){var t,a;for(t in doModal(e),N)(a=document.getElementById(t))&&a.addEventListener("click",N[t])},this.BuyXats=function(){ToC({name:"BuyXats",UserNo:g,Page:"actions",Command:"Action",Next:"pop",Type:"Action"})}};